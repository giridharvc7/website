---
const base = import.meta.env.BASE_URL.replace(/\/$/, ''); // strip trailing slash: '/website'
const home = `${base}/`;
const navLinks = [
  { href: home, label: 'Home' },
  { href: `${base}/work`, label: 'Work' },
  { href: `${base}/projects`, label: 'Projects' },
  { href: `${base}/writing`, label: 'Writing' },
];

const currentPath = Astro.url.pathname;
---

<nav>
  <div class="nav-inner">
    <div class="nav-right">
      <ul>
        {navLinks.map(link => (
          <li>
            <a
              href={link.href}
              class:list={[{ active: currentPath === link.href || (link.href !== home && currentPath.startsWith(link.href)) }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <button id="theme-toggle" type="button" aria-label="Toggle dark mode" title="Toggle theme">
        <span class="icon-sun">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
        </span>
        <span class="icon-moon">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </span>
      </button>
    </div>
  </div>
</nav>

<style>
  nav {
    border-bottom: none;
    height: var(--nav-height);
    display: flex;
    align-items: center;
  }

  .nav-inner {
    width: 100%;
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }

ul {
    display: flex;
    list-style: none;
    gap: 1.25rem;
    padding: 0;
    margin: 0;
  }

  li a {
    font-size: 0.875rem;
    color: var(--color-muted);
    text-decoration: none;
  }

  li a:hover,
  li a.active {
    color: var(--color-text);
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #theme-toggle {
    background: none;
    border: 1px solid var(--color-border);
    border-radius: 4px;
    cursor: pointer;
    padding: 0.3em 0.4em;
    line-height: 0;
    color: var(--color-muted);
    display: flex;
    align-items: center;
  }

  #theme-toggle:hover {
    color: var(--color-text);
  }

  :global(html.dark) .icon-sun { display: inline; }
  :global(html.dark) .icon-moon { display: none; }
  :global(html.light) .icon-sun { display: none; }
  :global(html.light) .icon-moon { display: inline; }
  :global(html:not(.dark):not(.light)) .icon-sun { display: none; }
  :global(html:not(.dark):not(.light)) .icon-moon { display: inline; }

  @media (prefers-color-scheme: dark) {
    :global(html:not(.dark):not(.light)) .icon-sun { display: inline; }
    :global(html:not(.dark):not(.light)) .icon-moon { display: none; }
  }

  @media (max-width: 600px) {
    .nav-inner {
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
    }

    nav {
      height: auto;
    }

    .nav-right {
      gap: 0.75rem;
    }

    ul {
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }
  }
</style>

<!-- Theme toggle behavior is centralized in Layout to survive view transitions -->
