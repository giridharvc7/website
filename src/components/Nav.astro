---
const base = import.meta.env.BASE_URL.replace(/\/$/, ''); // strip trailing slash: '/website'
const home = `${base}/`;
const navLinks = [
  { href: home, label: 'Home' },
  { href: `${base}/work`, label: 'Work' },
  { href: `${base}/projects`, label: 'Projects' },
  { href: `${base}/writing`, label: 'Writing' },
];

const currentPath = Astro.url.pathname;
---

<nav>
  <div class="nav-inner">
    <div class="nav-right">
      <ul>
        {navLinks.map(link => (
          <li>
            <a
              href={link.href}
              class:list={[{ active: currentPath === link.href || (link.href !== home && currentPath.startsWith(link.href)) }]}
            >
              {link.label}
            </a>
          </li>
        ))}
      </ul>
      <button id="theme-toggle" type="button" aria-label="Toggle dark mode" title="Toggle theme">
        <span class="icon-sun">&#9788;</span>
        <span class="icon-moon">&#9790;</span>
      </button>
    </div>
  </div>
</nav>

<style>
  nav {
    border-bottom: none;
    height: var(--nav-height);
    display: flex;
    align-items: center;
  }

  .nav-inner {
    width: 100%;
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 0 1.5rem;
    display: flex;
    align-items: center;
    justify-content: flex-end;
  }

ul {
    display: flex;
    list-style: none;
    gap: 1.25rem;
    padding: 0;
    margin: 0;
  }

  li a {
    font-size: 0.875rem;
    color: var(--color-muted);
    text-decoration: none;
  }

  li a:hover,
  li a.active {
    color: var(--color-text);
  }

  .nav-right {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  #theme-toggle {
    background: none;
    border: 1px solid var(--color-border);
    border-radius: 4px;
    cursor: pointer;
    padding: 0.2em 0.4em;
    font-size: 0.9rem;
    line-height: 1;
    color: var(--color-muted);
  }

  #theme-toggle:hover {
    color: var(--color-text);
  }

  :global(html.dark) .icon-sun { display: inline; }
  :global(html.dark) .icon-moon { display: none; }
  :global(html.light) .icon-sun { display: none; }
  :global(html.light) .icon-moon { display: inline; }
  :global(html:not(.dark):not(.light)) .icon-sun { display: none; }
  :global(html:not(.dark):not(.light)) .icon-moon { display: inline; }

  @media (prefers-color-scheme: dark) {
    :global(html:not(.dark):not(.light)) .icon-sun { display: inline; }
    :global(html:not(.dark):not(.light)) .icon-moon { display: none; }
  }

  @media (max-width: 600px) {
    .nav-inner {
      flex-direction: column;
      gap: 0.5rem;
      padding: 0.75rem 1.5rem;
    }

    nav {
      height: auto;
    }

    .nav-right {
      gap: 0.75rem;
    }

    ul {
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: center;
    }
  }
</style>

<script is:inline>
  (function() {
    const saved = localStorage.getItem('theme');
    if (saved) document.documentElement.classList.add(saved);

    document.getElementById('theme-toggle').addEventListener('click', function() {
      const html = document.documentElement;
      const isDark = html.classList.contains('dark') ||
        (!html.classList.contains('light') && window.matchMedia('(prefers-color-scheme: dark)').matches);
      html.classList.remove('dark', 'light');
      const next = isDark ? 'light' : 'dark';
      html.classList.add(next);
      localStorage.setItem('theme', next);
    });
  })();
</script>
